var content = [
	{
		num:1,
		title: "How Growth Hormone Can Lift the TBI Brain Fog",
		shortTitle: "TBI Brain Fog drug",
		subhead: "It was a few days after Thanksgiving in 2001, and Paula Offenhauser was rummaging for her plastic Christmas tree in the attic. Realizing she needed scissors to free the decorative shrub from its packaging, she headed back down to the floor below. The attic ladder was one of those steep, narrow, precarious ones. Offenhauser tripped at the top and tumbled down, her body crumpling at the bottom, wedged between the ladder and the door opposite the bottom rung. After that, she doesn’t remember much. “I went to the attic, and I woke up in a hospital six days later,” said Offenhauser. She hit the back of her head on either the wall or the ladder––the bloodstains were unclear. Her 25-month-old daughter answered the phone when Offenhauser’s sister called an hour later, and was able to communicate enough to prompt an immediate 911 call.",
		illustration: "assets/img/illustrations/tbi.png",
		instLogo: "assets/img/inst-logos/utmb.png",
		institution: "The University of Texas Medical Branch",
		link: "http://www.utsystempophealth.org/thj-stories/how-growth-hormone-can-lift-the-tbi-brain-fog",
		matter:true,
	},
	{
		num:2,
		title: "The Failure, and Unexpected Promise, of Stem Cell Treatment for TBIs",
		shortTitle: "Stem Cell Treatment",
		subhead: "Millions of Americans suffer from traumatic brain injuries (TBI) each year, but few therapies exist that can repair even minimal damage from severe TBI. As a result, treatments tend to be supportive rather than reparative. Dr. Charles Cox and his team are working to change that. “Traumatic brain injury is really two things: a primary injury and a secondary injury,” says Cox, Professor of Pediatric Surgery at McGovern Medical School at UTHealth in Houston. “The initial impact––on the ground or with an object––is the primary kinetic injury, and nothing can be done about that kinetic disruption of tissue. But then there is a secondary sequence of reactions as the body’s innate immune system responds to the damaged tissue, generating brain inflammation that ends up killing neurons.” Cox’s research is centered around using stem cell therapy to limit this collateral inflammatory damage that follows the immediate trauma of brain injury, so that some of the damaged tissue has a chance to recover.",
		illustration: "assets/img/illustrations/stem-cell.png",
		instLogo: "assets/img/inst-logos/utmb.png",
		institution: "UTHealth Houston",
		link: "http://www.utsystempophealth.org/thj-stories/the-failure-and-unexpected-promise",
		matter:true,
	},
	{
		num:3,
		title: "Diabetes Drug Shows Promise for Chronic Pain",
		shortTitle: "Diabetes Drug Shows Promise for Chronic Pain",
		subhead: "Scientists seeking an effective treatment for one type of chronic pain believe a ubiquitous, generic diabetes medication might solve both the discomfort and the mental deficits that go with the pain.“People who are in constant pain have problems thinking straight sometimes. The longer you’re in pain, the more entrenched the impairment becomes,” said Stephanie Shiers, a fourth-year cognition and neuroscience doctoral student at The University of Texas at Dallas and lead author of a study recently published in the Journal of Neuroscience. “These impairments aren’t addressed by existing therapeutics.”",
		illustration: "assets/img/illustrations/neuron.gif",
		instLogo: "assets/img/inst-logos/utmb.png",
		institution: "UTHealth Houston",
		link: "https://www.utdallas.edu/news/research/study-common-diabetes-drug-offers-hope-for-chronic-pain-patients/",
		matter:false,
	},
	{
		num:4,
		title: "Biochemists study enzymes to provide keys for drug development in cancer, bacterial infection and neurodegenerative disease",
		shortTitle: "Biochemists study enzymes to provide",
		subhead: "Researcher received a $429,033 National Institutes of Health grant to continue his work retro-engineering the sulfur oxidation process and mapping out of the chemical mechanism of three key enzymes.",
		illustration: "assets/img/illustrations/enzymatic.gif",
		instLogo: "assets/img/inst-logos/utmb.png",
		institution: "UTHealth Houston",
		link: "https://www.uta.edu/news/releases/2018/08/Brad%20Pierce%20NIH%20grant.php",
		matter:false,
	},
	{
		num:5,
		title: "Stroke Prevention Drug Combo Shows Promise",
		shortTitle: "Stroke Prevention Drug",
		subhead: "If you’ve had a minor stroke or a transient ischemic stroke (TIA), taking the clot-preventing drug clopidogrel along with aspirin may lower your risk of having a major stroke within the next 90 days, according to new research published in The New England Journal of Medicine. An international study of 4,881 adults in 10 countries who either had a minor stroke or a TIA showed that people who took clopidogrel plus aspirin had a 25 percent lower risk of a major stroke, heart attack or death from blood clots within the three months after the first incident, compared with those who took aspirin alone.",
		illustration: "assets/img/illustrations/Transient.png",
		instLogo: "assets/img/inst-logos/utmb.png",
		institution: "UTHealth Houston",
		link: "https://dellmed.utexas.edu/news/stroke-prevention-drug-combo-shows-promise-study-says",
		matter:false,
	},
	{
		num:6,
		title: "Rapamycin lotion reduces facial tumors caused by tuberous sclerosis",
		shortTitle: "Rapamycin lotion reduces facial tumors",
		subhead: "“People with tuberous sclerosis complex want to look like everyone else,” said Mary Kay Koenig, M.D., the study’s lead author, co-director of the Tuberous Sclerosis Center of Excellence and holder of the Endowed Chair of Mitochondrial Medicine at McGovern Medical School at UTHealth. “And, they can with this treatment.” Tuberous sclerosis complex affects about 50,000 people in the United States and is characterized by the uncontrolled growth of non-cancerous tumors throughout the body.",
		illustration: "assets/img/illustrations/Freckles.gif",
		instLogo: "assets/img/inst-logos/utmb.png",
		institution: "UTHealth Houston",
		link: "https://www.uth.edu/media/story.htm?id=37af25df-14a2-4c5e-b1ee-ac9585946aa0",
		matter:false,
	},
	{
		num:7,
		title: "The 40 Year-old Discovery Behind A Promising New Flu Drug",
		shortTitle: "The 40 Year-old Discovery Behind A Promising New Flu Drug",
		subhead: "Existing flu treatments, such as Tamiflu, attack the virus after it has replicated in host cells; they work by making it harder for daughter viruses to escape from the host cell. The new drug Xofluza, on the other hand, attacks the flu virus at the early stage that Krug's research illuminated, blocking flu before it is able to create daughter viruses. ”It stops the virus cold,” Krug said. ”It can't do anything.” Theoretically, this should make the new drug exquisitely effective at halting progression of the disease. And already human trials have demonstrated that Xofluza patients have a much lower viral load in the first three days of treatment than Tamiflu patients and stop shedding flu virus in about a day, compared to about three days with Tamiflu.",
		illustration: "assets/img/illustrations/rna.png",
		instLogo: "assets/img/inst-logos/utmb.png",
		institution: "UTHealth Houston",
		link: "https://cns.utexas.edu/news/the-40-year-old-discovery-behind-a-promising-new-flu-drug",
		matter:false,
	},
	{
		num:8,
		title: "A Score to Settle with Cancer",
		shortTitle: "A Score to Settle with Cancer",
		subhead: "Jonathan Sessler was a college student when he was first diagnosed with Hodgkin's lymphoma. Fortunately, he was also a chemistry major. After surviving radiation therapy, relapsing and then surviving extremely high doses of what he calls ”rat poison” (a.k.a. chemotherapy), his oncologist challenged him: ”You're a chemist. Find new cancer drugs.” In the four decades since, he's founded two companies, one of which commercialized a blockbuster drug for leukemia and was sold for $21 billion. The other is working to develop a drug he invented to treat ovarian cancer, based on large molecules that deliver poisons to cancer cells and named after the Lone Star state: Texaphyrin. He knows the odds of bringing effective new cancer treatments to market are stacked against him, yet he tirelessly pushes ahead.",
		illustration: "assets/img/illustrations/tx-mol.png",
		instLogo: "assets/img/inst-logos/utmb.png",
		institution: "UTHealth Houston",
		link: "https://cns.utexas.edu/point/a-score-to-settle-with-cancer",
		matter:false,
	},
	{
		num:9,
		title: "Drug from Bat Flower shrinks resistant tumors",
		shortTitle: "The Bat Flower Drug",
		subhead: "There is nothing bleaker to a family than being told that their loved one’s cancer has stopped responding to chemotherapy and there are no more options. UT Health San Antonio and spinoff company Terrona LLC want to end that. “We can help patients for a time, but there comes a point when we do not have further therapy that we can utilize,” said Susan L. Mooberry, Ph.D., professor of pharmacology in the Joe R. & Teresa Lozano Long School of Medicine at UT Health San Antonio.",
		illustration: "assets/img/illustrations/bat-flower.gif",
		instLogo: "assets/img/inst-logos/utmb.png",
		institution: "UTHealth Houston",
		link: "https://news.uthscsa.edu/drug-from-bat-flower-shrinks-resistant-tumors/",
		matter:false,
	},
	{
		num:10,
		title: "Pediatric cancer drug shows 93 percent response rate",
		shortTitle: "Pediatric cancer drug shows 93 percent response rate",
		subhead: " A first-of-its-kind drug targeting a fused gene found in many types of cancer was effective in 93 percent of pediatric patients tested, researchers at UT Southwestern’s Simmons Cancer Center announced. Most cancer drugs are targeted to specific organs or locations in the body. Larotrectinib is the first cancer drug to receive FDA breakthrough therapy designation for patients with a specific fusion of two genes in the cancer cell, no matter what cancer type. The research appears in The Lancet Oncology.",
		illustration: "assets/img/illustrations/Genes.gif",
		instLogo: "assets/img/inst-logos/utmb.png",
		institution: "UTHealth Houston",
		link: "https://www.utsouthwestern.edu/newsroom/articles/year-2018/pediatric-cancer-drug.html",
		matter:false,
	},
	{
		num:11,
		title: "Healing the Damaged Lung",
		shortTitle: "Healing the Damaged Lung",
		subhead: "Drugs show promise for reversing scarring and returning lungs to healthy functioning.",
		illustration: "assets/img/illustrations/Lungs.gif",
		instLogo: "assets/img/inst-logos/utmb.png",
		institution: "UTHealth Houston",
		link: "https://www.easttexasmatters.com/news/local-news/lung-scarring-reversal-drugs-discovered-by-local-doctors-sees-great-progress/674313067",
		matter:false,
	},
	{
		num:12,
		title: "Newly developed therapeutic shown to combat drug addiction",
		shortTitle: "A Drug to Combat Drug Addiction!",
		subhead: "The researchers trained rats to press on a lever for cocaine infusions at certain light cues. Once the rats learned this cocaine-seeking behavior, half of them received the most promising therapeutic and the other half received only saline.",
		illustration: "assets/img/illustrations/drug-addiction.gif",
		instLogo: "assets/img/inst-logos/utmb.png",
		institution: "UTHealth Houston",
		link: "https://www.utmb.edu/newsroom/article11798.aspx",
		matter:false,
	}
]

var idArr = ["home"]

content.forEach(function(drug){
	var secId = "section"+drug.num;
	var fpId = "drug"+drug.num
	idArr.push(fpId)
	var matterId = "sec"+drug.num+"-matter"

	var drugSec = $("<div class='section' id='"+secId+"'></div>")
	var secWrap = $("<div class='sec-wrap'>")
	var graphicCol = $("<div class='d-graphicCol'>")
	var graphicContain = $("<div class='graphic-container d-graphic-container'>")
	var staticImg = $("<div class='pngAndCanvas png-container'><img src='"+drug.illustration+"'></div>")
	if(drug.matter){
		var matterDiv = $("<div class='pngAndCanvas d-canvas' id='"+matterId+"'</div>");
		graphicContain.append(matterDiv)
	}
	var infoCol= $("<div class='d-info-col'>")
	var drugNum = $("<div class='num'><h1>"+drug.num+"</h1><div>")
	var title = $("<div class='title'><h1>"+drug.title+"</h1></div>");
	var subhead = $("<div class='subhead'><p>"+drug.subhead+"</p></div>")
	var links = $("<div class='links'><div class='link'><a href='"+drug.link+"' target='_blank'><i class='fas fa-link'></i> Read More</a></div><div class='inst-logo'><img src='"+drug.instLogo+"'></div></div>")
	

	$("#fullpage").append(drugSec);
	drugSec.append(secWrap)
	secWrap.append(graphicCol)
	graphicCol.append(graphicContain)
	graphicContain.append(staticImg)
	secWrap.append(infoCol)
	infoCol.append(drugNum)
	infoCol.append(title)
	infoCol.append(subhead)
	infoCol.append(links)


	if(drug.shortTitle.length>25){
		drug.shortTitle = drug.shortTitle.substr(0,25)+"..."
	}
	var navItem = $("<a class='nav-item' id='d-num-"+drug.num+"' href='#"+fpId+"'><li><span class='drug-number' >"+drug.num+"</span><span class='drug-title'>. "+drug.shortTitle+"</span></li></a>");
	$(".navlist ul").append(navItem)

	})

// ***** fullpage JS *****

var myFullpage = new fullpage('#fullpage', {
	//Navigation
	menu: '#menu',
	lockAnchors: false,
	anchors: idArr,
	navigation: false,
	// navigationPosition: 'top',
	navigationTooltips: [' ', 'secondSlide'],
	showActiveTooltip: true,
	slidesNavigation: false,
	slidesNavPosition: 'bottom',

	//Scrolling
	css3: true,
	scrollingSpeed: 1000,
	autoScrolling: true,
	fitToSection: true,
	fitToSectionDelay: 1000,
	scrollBar: false,
	easing: 'easeInOutCubic',
	easingcss3: 'ease',
	loopBottom: false,
	loopTop: false,
	loopHorizontal: true,
	continuousVertical: false,
	continuousHorizontal: false,
	scrollHorizontally: false,
	interlockedSlides: false,
	dragAndMove: false,
	offsetSections: false,
	resetSliders: false,
	fadingEffect: true,
	// normalScrollElements: '.graphic-container',
	scrollOverflow: true,
	scrollOverflowReset: false,
	scrollOverflowOptions: null,
	touchSensitivity: 15,
	normalScrollElementTouchThreshold: 5,
	bigSectionsDestination: null,

	//Accessibility
	keyboardScrolling: true,
	animateAnchor: true,
	recordHistory: true,

	//Design
	controlArrows: true,
	verticalCentered: true,
	// sectionsColor : ['#000', '#FF7F51', "#720026", "#C7EFCF", "#333745"],
	paddingTop: '3em',
	paddingBottom: '10px',
	fixedElements: '#header, .footer',
	responsiveWidth: 0,
	responsiveHeight: 0,
	responsiveSlides: false,
	parallax: false,
	parallaxOptions: {type: 'reveal', percentage: 62, property: 'translate'},

	//Custom selectors
	sectionSelector: '.section',
	slideSelector: '.slide',

	lazyLoading: true,

	//events
	onLeave: function(origin, destination, direction){
		// console.log(origin, destination,direction)
		if (origin.index === 0 ||destination.index === 0){
			$(".sidebar").toggleClass("invisible")
		}
		$(".nav-item").removeClass("active")
		var targetNav = "#d-num-"+destination.index;
		$(targetNav).addClass("active")
	},
	afterLoad: function(origin, destination, direction){
		// console.log(destination)
		
	},
	afterRender: function(){},
	afterResize: function(width, height){},
	afterResponsive: function(isResponsive){},
	afterSlideLoad: function(section, origin, destination, direction){},
	onSlideLeave: function(section, origin, destination, direction){}
});


// ***** Sidebar *****
$("#nav-btn").on("click", function(){
	$("#sidebar").toggleClass("expanded")
})

$("#sidebar").on("mouseover", function(){
	$("#sidebar").addClass("expanded")
})
$("#fullpage").on("mouseover", function(){
	if($("#sidebar").hasClass("expanded")){
		$("#sidebar").removeClass("expanded")
	}
	
})



///THIS IS GOING TO BE CREATING ALL SLIDES






//seting the height of the graphic so that it's centered vertically
function alignHomeslide(){
	var mwidth = document.getElementById("svg-container").offsetWidth
	var mheight = document.getElementById("svg-container").offsetHeight
	$("#graphic-container").css("height", mheight)
}
alignHomeslide();
window.addEventListener('resize', alignHomeslide);


// see more function for subheads
var showChar = 250;
var ellipsestext = "...";
var moretext = ">>";
var lesstext = "<<";
$('.subhead p').each(function () {
    var content = $(this).html();
    if (content.length > showChar) {
        var show_content = content.substr(0, showChar);
        var hide_content = content.substr(showChar, content.length - showChar);
        var html = show_content + '<span class="moreelipses">' + ellipsestext + '</span><span class="remaining-content"><span>' + hide_content + '</span>&nbsp;&nbsp;<a href="" class="morelink">' + moretext + '</a></span>';
        $(this).html(html);
    }
});

$(".morelink").click(function () {
    if ($(this).hasClass("less")) {
        $(this).removeClass("less");
        $(this).html(moretext);
    } else {
        $(this).addClass("less");
        $(this).html(lesstext);
    }
    $(this).parent().prev().toggle();
    $(this).prev().toggle();
    return false;
});







// ***** Matter JS physics engine *****

// module aliases
var Engine = Matter.Engine,
    Render = Matter.Render,
    World = Matter.World,
	Bodies = Matter.Bodies,
	MouseConstraint = Matter.MouseConstraint,
	Mouse = Matter.Mouse,
	Body = Matter.Body,
	Svg = Matter.Svg,
    Vertices = Matter.Vertices,
	Constraint = Matter.Constraint,
	Events = Matter.Events;

// create an engine
var engine1 = Engine.create();
engine1.world.gravity.y = 0.2;
var homeMatter = document.getElementById('home-matter');
console.log(homeMatter)
// create a renderer
var render1 = Render.create({
    element: homeMatter,
    engine: engine1,
    options: {
        width: 1116,
        height: 730,
        pixelRatio: 1,
        background: 'none',
		wireframeBackground: '#111',
		wireframes: false,

        // hasBounds: false,
        // enabled: false,
        
        // showSleeping: true,
        // showDebug: true,
        // showBroadphase: false,
        // showBounds: false,
        // showVelocity: false,
        // showCollisions: false,
        // showSeparations: false,
        // showAxes: false,
        // showPositions: false,
        // showAngleIndicator: false,
        // showIds: false,
        // showShadows: false,
        // showVertexNumbers: false,
        // showConvexHulls: false,
        // showInternalEdges: false,
        // showMousePosition: false
    }
}
);


var pillpath= "330.6,0 1116,0 1116,730 0,730 0,0 330.6,0 332.1,86.2 310.1,86.3 242.3,102.5 181.1,140.9 128.3,191.7 97,271.9 97,415.2 117.9,488.8 175.9,565.1 241,613.9 336.8,639.4 827.7,639.4 871.2,632.4 927.4,603.3 982.7,546 1024.9,447.8 1031.4,390.5 1031.4,308.4 994.3,208.7 927.1,136.3 804,86.2 332.1,86.2 330.6,0";


var pillVertices = [];
parsePath(pillpath, pillVertices);

// a custom function to parse illustrator paths into arrays of verticies
//Get's a path sting and an empty array and posh point coordinates into the array
function parsePath(path, vertices){
	var splitted = path.split(" ")
	for(var i =0; i< splitted.length; i++){
		var xyArray = splitted[i].split(",")
		var point = {
			x: parseInt(xyArray[0]),
			y: parseInt(xyArray[1])
		}
		vertices.push(point);
		console.log(vertices)
	}
}

var colors=["rgba(247,147,30,1)", "rgba(102,166,196,1)", "rgba(252,115,117,1)"]
var colors2=["rgba(68,98,120,1)", "rgba(255,217,125,1)", "rgba(244,96,54,1)", "rgba(244,96,54,1)"]
var circlesArr = []
for(var i=0; i<25; i++){
	var pickedColor = getRandom(0,2);
	circlesArr.push(Bodies.circle(getRandom(155,890), getRandom(150,345),getRandom(50,70), {
		render:{
			fillStyle: colors[pickedColor]
		}
	}));
	World.add(engine1.world, circlesArr[i]);
	// console.log("YAY", circlesArr)
}


// create two boxes and a ground

var ceiling = Bodies.rectangle(1116/2,40,1110,86, {
	isStatic:true,
	render:{
		fillStyle: 'rgba(200,200,0,0)'
	}
})

var pillShell = Bodies.fromVertices(1110/2,730/2, pillVertices , {
	isStatic : true,
	render: {
		fillStyle: 'rgba(200,200,0,0)',
		strokeStyle: "rgba(0,0,0,0)",
   }
})

function getRandom(min,max){
    return Math.floor(Math.random()*(max-min+1)+min);
}

// add all of the bodies to the world
World.add(engine1.world, [ pillShell, ceiling]);
// World.add(engine.world, circlesArr);
console.log(circlesArr)

var mouse = Mouse.create(render1.canvas),
	mouseConstraint = MouseConstraint.create(engine1, {
		mouse: mouse,
		constraint: {
			stiffness: 0.01,
			render: {
				visible: false
			}
		}
	});

World.add(engine1.world, mouseConstraint);


// keep the mouse in sync with rendering
render1.mouse = mouse;

// run the engine1
Engine.run(engine1);

// run the renderer
Render.run(render1);

var homeCanvas = document.getElementById("home-matter")
var hovered = null;
var hoveredIndex;
homeCanvas.addEventListener("mousemove", function(e){
	var coordinates = getMousePos(homeCanvas, e);
	// console.log(coordinates)
	var hoveredArr = Matter.Query.point(circlesArr,coordinates)
	if (!hovered){
		hovered = Matter.Query.point(circlesArr,coordinates)[0]
		hoveredIndex = hovered.id -1
		hovered.render.strokeStyle = "rgba(255,255, 255,1)"
		hovered.render.lineWidth = 3
	}else{
		if (hoveredArr.length ===1){
			// homeCanvas.addEventListener("click", function(){
			// 	window.location.href = '#sec3'
			// })
			homeCanvas.style.cursor = 'grab';
			if(hoveredArr[0].id === hovered.id){
				hovered = Matter.Query.point(circlesArr,coordinates)[0]
				hoveredIndex = hovered.id -1
				hovered.render.strokeStyle = "rgba(255,255, 255,1)"
				hovered.render.lineWidth = 3
			}else{
				hoveredIndex = hovered.id -1
				var unhovered = circlesArr[hoveredIndex];
				unhovered.render.lineWidth = 0
				hovered = Matter.Query.point(circlesArr,coordinates)[0]
			}
		}else{
			homeCanvas.style.cursor = 'default';
			console.log(hoveredIndex)
			var unhovered = circlesArr[hoveredIndex];
			unhovered.render.lineWidth = 0
		}


	}
	
})
function getMousePos(canvas, evt) {
	var rect = canvas.getBoundingClientRect();
	var skewedX = evt.clientX - rect.left,
		skewedY = evt.clientY - rect.top,
		canvasWidth = rect.width,
		canvasHeight= rect.height;

	var realX= (1116/canvasWidth)*skewedX,
		realY= (1116/canvasWidth)*skewedY;

    return {
      x: realX,
      y: realY
    };
}

function applyForce(){
	for(var i=0; i<circlesArr.length; i++){
		Body.applyForce(circlesArr[i], {x: circlesArr[i].position.x, y: circlesArr[i].position.y}, {x: getRandom(-0.005,0.005), y: getRandom(-0.001,-0.0001)})
	}
}

window.setInterval(applyForce, 2000);




///Matter JS for section 2
var engine2 = Engine.create();
var sec2Matter = document.getElementById("sec1-matter")
var render2 = Render.create({
    element: sec2Matter,
    engine: engine2,
    options: {
        width: 640,
        height: 800,
        pixelRatio: 1,
        background: 'rgba(200,200,0,0)',
		wireframeBackground: '#eee',
		wireframes: false,
    }
}
);




var gland = Bodies.circle(315, 285,30, {
	render:{
		fillStyle: "rgba(252,115,117,1)",
	}
})
// var gladPoint = Bodies.circle(300, 290,1, {
// 	isStatic: true,
// })
var glandConnection = Constraint.create({
	pointA: {x: 315, y: 285},
	bodyB: gland,
	// pointB: {x:300, y: 280},
	stiffness: 0.05,
	length: 1,
	render:{
		visible: false,
	}
})
World.add(engine2.world, [gland, glandConnection]);

var mouse2 = Mouse.create(render2.canvas),
        mouseConstraint = MouseConstraint.create(engine2, {
            mouse: mouse2,
            constraint: {
				stiffness: 0.05,
                render: {
					visible: false,
                }
			}
        });

World.add(engine2.world, mouseConstraint);


// keep the mouse in sync with rendering
render2.mouse = mouse2;
// run the engine1
Engine.run(engine2);

// run the renderer
Render.run(render2);

function applyForce2(){
	Body.applyForce(gland, {x: gland.position.x, y: gland.position.y}, {x: randomPosNeg()*Math.random()*0.1, y: randomPosNeg()*Math.random()*0.1})
}

window.setInterval(applyForce2, 4500);


function randomPosNeg(){
	if(Math.random()>0.5){
		return -1;
	}else{
		return 1;
	}
}



///Matter JS for section 3
var engine3 = Engine.create();
// engine3.world.gravity.y = 0.4;

var sec3Matter = document.getElementById("sec2-matter")
var render3 = Render.create({
    element: sec3Matter,
    engine: engine3,
    options: {
        width: 640,
        height: 800,
        pixelRatio: 1,
        background: 'rgba(200,200,0,0)',
		wireframeBackground: '#eee',
		wireframes: false,
    }
}
);




var wall2= Bodies.rectangle(650, 400,20, 1800, {isStatic:true, render:{visible: false}, restitution:0.9})
var ground= Bodies.rectangle(320, 850,1200, 100, {isStatic:true, render:{visible: false}, restitution:0.9})

var cell1options = {
	friction:0.5,
	frictionAir:0.01,
	restitution:0.5,
	render:{
		fillStyle: colors[getRandom(0,2)]
	}
}
var cell = Bodies.circle(145, 565,45, cell1options)




var cellConnection = Constraint.create({
	pointA: {x: 145, y: 565},
	bodyB: cell,
	// pointB: {x:300, y: 280},
	stiffness: 0.007,
	length: 1,
	render:{
		visible: true,
		type: "line",
		lineWidth: 1
	}
})

var cell2options = {
	friction:0.05,
	frictionAir:0.05,
	restitution:0.9,
	render:{
		fillStyle: colors2[getRandom(0,2)]
	}
}
var cell2 = Bodies.circle(383, 330,15,cell2options)

var cell2Connection = Constraint.create({
	pointA: {x: 383, y: 330},
	bodyB: cell2,
	// pointB: {x:300, y: 280},
	stiffness: 0.05,
	length: 1,
	render:{
		visible: true,
		type: "line",
		lineWidth: 1
	}
})
World.add(engine3.world, [cell, cellConnection, ground, wall2, cell2, cell2Connection]);

var mouse3 = Mouse.create(render3.canvas),
        mouseConstraint = MouseConstraint.create(engine3, {
            mouse: mouse3,
            constraint: {
				stiffness: 0.5,
                render: {
					visible: false,
                }
			}
        });

// Events.on(engine3, 'afterUpdate', function() {
// 	if (mouseConstraint.mouse.button === -1 && (cell.position.x > 165 || cell.position.y < 545)) {
// 		cell = Bodies.circle(145, 565, 45, {density: 0.004, render:{
// 			fillStyle: colors[getRandom(0,2)],
// 		}});
// 		World.add(engine3.world, cell);
// 		cellConnection.bodyB = cell;
// 	}
// });
// World.add(engine3.world, mouseConstraint);


addCanon(145,565,45,cell,cellConnection, cell1options, colors);
addCanon(383,330,15,cell2,cell2Connection, cell2options, colors2);



function addCanon(x,y,radius, object, objectConnection, options, colArr){
	Events.on(engine3, 'afterUpdate', function() {
		if (mouseConstraint.mouse.button === -1 && (object.position.x > x+30 || object.position.y < y-30)) {
			options.render.fillStyle = colArr[getRandom(0,colArr.length-1)]
			object = Bodies.circle(x, y, radius, options);
			World.add(engine3.world, object);
			objectConnection.bodyB = object;
		}
	});
	World.add(engine3.world, mouseConstraint);
	
}

// keep the mouse in sync with rendering
render3.mouse = mouse3;
Engine.run(engine3);

// run the renderer
Render.run(render3);